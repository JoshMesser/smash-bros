{{create-match onCreate=(action 'onCreate')}}

{{#if matches}}

<ul class="match-listing">
  {{#each formattedMatches as |matchObj|}}
    <li>
      {{#paper-button raised=true primary=true onClick=(action 'toggleMatchVisibility' matchObj.state) }}
        {{if matchObj.state.hidden 'Show' 'Hide'}} matches on {{output-date matchObj.created}}
      {{/paper-button}}

      <div class="layout-row layout-wrap layout-xs-column {{if matchObj.state.hidden 'hide'}}">

        {{#each matchObj.matches as |match|}}
          <div class="flex-xs flex-gt-xs-25">

            {{#paper-card as |card|}}
              {{#card.title as |title|}}
                {{#title.text as |text|}}
                  {{#text.headline}}
                    {{match.type}} {{match.coop}}
                  {{/text.headline}}
                  {{#text.subhead}}
                    {{match.limit}} Minutes
                  {{/text.subhead}}
                {{/title.text}}
                {{title.media size="lg" src=match.stageImage alt=match.stage title=match.stage}}
              {{/card.title}}

              {{#card.content class="layout-row layout-align-space-between"}}
                {{#paper-list}}
                  {{#each match.players as |player|}}
                    {{#paper-item class="md-2-line"}}
                      {{#if player.character}}
                        <img src="{{player.smallCharacterImage}}" class="md-avatar" title="{{player.character}}" />
                      {{/if}}
                      <div class="md-list-item-text">
                        <h3>{{player.userDisplayName}}</h3>
                        <p>Score: {{player.score}}</p>
                      </div>
                       {{paper-divider inset=true}}
                    {{/paper-item}}
                  {{/each}}
                {{/paper-list}}

              {{/card.content}}

              {{#card.actions}}
                {{#paper-button onClick=(action 'transition' 'match' match.id)}}View Details{{/paper-button}}

                {{!-- Check to see if this player is already a part of this match --}}
                {{#if match.players.isFulfilled}}
                  {{#unless (includes (map-by match.players 'userDisplayName') session.currentUser.displayName) }}
                    {{#paper-button onClick=(action 'joinMatch' match)}}Join{{/paper-button}}
                  {{/unless}}
                {{/if}}

                {{#paper-button warn=true onClick=(action 'deleteMatch' key match)}}Delete{{/paper-button}}
              {{/card.actions}}
            {{/paper-card}}

          </div>
        {{/each}}
      </div>
    </li>
  {{/each}}
</ul>

{{/if}}